<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Group 12 – nlp</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Group 12</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../Intro.html" rel="" target="">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../eda.html" rel="" target="">
 <span class="menu-text">EDA</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../nlp.html" rel="" target="">
 <span class="menu-text">NLP</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../ml.html" rel="" target="">
 <span class="menu-text">ML</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../summary.html" rel="" target="">
 <span class="menu-text">Summary</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup - Run only once per Kernel App</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>conda install https:<span class="op">//</span>anaconda.org<span class="op">/</span>conda<span class="op">-</span>forge<span class="op">/</span>openjdk<span class="op">/</span><span class="fl">11.0.1</span><span class="op">/</span>download<span class="op">/</span>linux<span class="op">-</span><span class="dv">64</span><span class="op">/</span>openjdk<span class="op">-</span><span class="fl">11.0.1</span><span class="op">-</span>hacce0ff_1021.tar.bz2</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install PySpark</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install pyspark<span class="op">==</span><span class="fl">3.4.0</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># restart kernel</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.core.display <span class="im">import</span> HTML</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>HTML(<span class="st">"&lt;script&gt;Jupyter.notebook.kernel.restart()&lt;/script&gt;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Retrieving notices: ...working... done

Downloading and Extracting Packages:


## Package Plan ##

  environment location: /opt/conda

  added / updated specs:
    - conda-forge/openjdk/11.0.1/download/linux-64::openjdk==11.0.1=hacce0ff_1021


The following NEW packages will be INSTALLED:

  openjdk            conda-forge/openjdk/11.0.1/download/linux-64::openjdk-11.0.1-hacce0ff_1021 



Downloading and Extracting Packages:

Preparing transaction: done
Verifying transaction: done
Executing transaction: done

Note: you may need to restart the kernel to use updated packages.
Collecting pyspark==3.4.0
  Using cached pyspark-3.4.0-py2.py3-none-any.whl
Requirement already satisfied: py4j==0.10.9.7 in /opt/conda/lib/python3.11/site-packages (from pyspark==3.4.0) (0.10.9.7)
Installing collected packages: pyspark
Successfully installed pyspark-3.4.0
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="1">
<script>Jupyter.notebook.kernel.restart()</script>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install spark<span class="op">-</span>nlp<span class="op">==</span><span class="fl">5.5.0</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install spark<span class="op">-</span>nlp <span class="op">--</span>upgrade</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Collecting spark-nlp==5.5.0
  Using cached spark_nlp-5.5.0-py2.py3-none-any.whl.metadata (19 kB)
Using cached spark_nlp-5.5.0-py2.py3-none-any.whl (620 kB)
Installing collected packages: spark-nlp
Successfully installed spark-nlp-5.5.0
Requirement already satisfied: spark-nlp in /opt/conda/lib/python3.11/site-packages (5.5.0)
Collecting spark-nlp
  Using cached spark_nlp-5.5.1-py2.py3-none-any.whl.metadata (19 kB)
Using cached spark_nlp-5.5.1-py2.py3-none-any.whl (626 kB)
Installing collected packages: spark-nlp
  Attempting uninstall: spark-nlp
    Found existing installation: spark-nlp 5.5.0
    Uninstalling spark-nlp-5.5.0:
      Successfully uninstalled spark-nlp-5.5.0
Successfully installed spark-nlp-5.5.1</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sparknlp</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> sparknlp.start()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>sparknlp.version()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>spark.version</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>:: loading settings :: url = jar:file:/opt/conda/lib/python3.11/site-packages/pyspark/jars/ivy-2.5.1.jar!/org/apache/ivy/core/settings/ivysettings.xml</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Ivy Default Cache set to: /home/sagemaker-user/.ivy2/cache
The jars for the packages stored in: /home/sagemaker-user/.ivy2/jars
com.johnsnowlabs.nlp#spark-nlp_2.12 added as a dependency
:: resolving dependencies :: org.apache.spark#spark-submit-parent-74b5a337-1aa9-4b49-ac16-fc97eb9c486a;1.0
    confs: [default]
    found com.johnsnowlabs.nlp#spark-nlp_2.12;5.5.1 in central
    found com.typesafe#config;1.4.2 in central
    found org.rocksdb#rocksdbjni;6.29.5 in central
    found com.amazonaws#aws-java-sdk-s3;1.12.500 in central
    found com.amazonaws#aws-java-sdk-kms;1.12.500 in central
    found com.amazonaws#aws-java-sdk-core;1.12.500 in central
    found commons-logging#commons-logging;1.1.3 in central
    found commons-codec#commons-codec;1.15 in central
    found org.apache.httpcomponents#httpclient;4.5.13 in central
    found org.apache.httpcomponents#httpcore;4.4.13 in central
    found software.amazon.ion#ion-java;1.0.2 in central
    found joda-time#joda-time;2.8.1 in central
    found com.amazonaws#jmespath-java;1.12.500 in central
    found com.github.universal-automata#liblevenshtein;3.0.0 in central
    found com.google.protobuf#protobuf-java-util;3.0.0-beta-3 in central
    found com.google.protobuf#protobuf-java;3.0.0-beta-3 in central
    found com.google.code.gson#gson;2.3 in central
    found it.unimi.dsi#fastutil;7.0.12 in central
    found org.projectlombok#lombok;1.16.8 in central
    found com.google.cloud#google-cloud-storage;2.20.1 in central
    found com.google.guava#guava;31.1-jre in central
    found com.google.guava#failureaccess;1.0.1 in central
    found com.google.guava#listenablefuture;9999.0-empty-to-avoid-conflict-with-guava in central
    found com.google.errorprone#error_prone_annotations;2.18.0 in central
    found com.google.j2objc#j2objc-annotations;1.3 in central
    found com.google.http-client#google-http-client;1.43.0 in central
    found io.opencensus#opencensus-contrib-http-util;0.31.1 in central
    found com.google.http-client#google-http-client-jackson2;1.43.0 in central
    found com.google.http-client#google-http-client-gson;1.43.0 in central
    found com.google.api-client#google-api-client;2.2.0 in central
    found com.google.oauth-client#google-oauth-client;1.34.1 in central
    found com.google.http-client#google-http-client-apache-v2;1.43.0 in central
    found com.google.apis#google-api-services-storage;v1-rev20220705-2.0.0 in central
    found com.google.code.gson#gson;2.10.1 in central
    found com.google.cloud#google-cloud-core;2.12.0 in central
    found io.grpc#grpc-context;1.53.0 in central
    found com.google.auto.value#auto-value-annotations;1.10.1 in central
    found com.google.auto.value#auto-value;1.10.1 in central
    found javax.annotation#javax.annotation-api;1.3.2 in central
    found com.google.cloud#google-cloud-core-http;2.12.0 in central
    found com.google.http-client#google-http-client-appengine;1.43.0 in central
    found com.google.api#gax-httpjson;0.108.2 in central
    found com.google.cloud#google-cloud-core-grpc;2.12.0 in central
    found io.grpc#grpc-alts;1.53.0 in central
    found io.grpc#grpc-grpclb;1.53.0 in central
    found org.conscrypt#conscrypt-openjdk-uber;2.5.2 in central
    found io.grpc#grpc-auth;1.53.0 in central
    found io.grpc#grpc-protobuf;1.53.0 in central
    found io.grpc#grpc-protobuf-lite;1.53.0 in central
    found io.grpc#grpc-core;1.53.0 in central
    found com.google.api#gax;2.23.2 in central
    found com.google.api#gax-grpc;2.23.2 in central
    found com.google.auth#google-auth-library-credentials;1.16.0 in central
    found com.google.auth#google-auth-library-oauth2-http;1.16.0 in central
    found com.google.api#api-common;2.6.2 in central
    found io.opencensus#opencensus-api;0.31.1 in central
    found com.google.api.grpc#proto-google-iam-v1;1.9.2 in central
    found com.google.protobuf#protobuf-java;3.21.12 in central
    found com.google.protobuf#protobuf-java-util;3.21.12 in central
    found com.google.api.grpc#proto-google-common-protos;2.14.2 in central
    found org.threeten#threetenbp;1.6.5 in central
    found com.google.api.grpc#proto-google-cloud-storage-v2;2.20.1-alpha in central
    found com.google.api.grpc#grpc-google-cloud-storage-v2;2.20.1-alpha in central
    found com.google.api.grpc#gapic-google-cloud-storage-v2;2.20.1-alpha in central
    found com.google.code.findbugs#jsr305;3.0.2 in central
    found io.grpc#grpc-api;1.53.0 in central
    found io.grpc#grpc-stub;1.53.0 in central
    found org.checkerframework#checker-qual;3.31.0 in central
    found io.perfmark#perfmark-api;0.26.0 in central
    found com.google.android#annotations;4.1.1.4 in central
    found org.codehaus.mojo#animal-sniffer-annotations;1.22 in central
    found io.opencensus#opencensus-proto;0.2.0 in central
    found io.grpc#grpc-services;1.53.0 in central
    found com.google.re2j#re2j;1.6 in central
    found io.grpc#grpc-netty-shaded;1.53.0 in central
    found io.grpc#grpc-googleapis;1.53.0 in central
    found io.grpc#grpc-xds;1.53.0 in central
    found com.navigamez#greex;1.0 in central
    found dk.brics.automaton#automaton;1.11-8 in central
    found com.johnsnowlabs.nlp#tensorflow-cpu_2.12;0.4.4 in central
    found com.microsoft.onnxruntime#onnxruntime;1.19.2 in central
    found com.johnsnowlabs.nlp#jsl-llamacpp-cpu_2.12;0.1.4 in central
    found org.jetbrains#annotations;24.1.0 in central
    found com.johnsnowlabs.nlp#jsl-openvino-cpu_2.12;0.1.0 in central
:: resolution report :: resolve 1876ms :: artifacts dl 61ms
    :: modules in use:
    com.amazonaws#aws-java-sdk-core;1.12.500 from central in [default]
    com.amazonaws#aws-java-sdk-kms;1.12.500 from central in [default]
    com.amazonaws#aws-java-sdk-s3;1.12.500 from central in [default]
    com.amazonaws#jmespath-java;1.12.500 from central in [default]
    com.github.universal-automata#liblevenshtein;3.0.0 from central in [default]
    com.google.android#annotations;4.1.1.4 from central in [default]
    com.google.api#api-common;2.6.2 from central in [default]
    com.google.api#gax;2.23.2 from central in [default]
    com.google.api#gax-grpc;2.23.2 from central in [default]
    com.google.api#gax-httpjson;0.108.2 from central in [default]
    com.google.api-client#google-api-client;2.2.0 from central in [default]
    com.google.api.grpc#gapic-google-cloud-storage-v2;2.20.1-alpha from central in [default]
    com.google.api.grpc#grpc-google-cloud-storage-v2;2.20.1-alpha from central in [default]
    com.google.api.grpc#proto-google-cloud-storage-v2;2.20.1-alpha from central in [default]
    com.google.api.grpc#proto-google-common-protos;2.14.2 from central in [default]
    com.google.api.grpc#proto-google-iam-v1;1.9.2 from central in [default]
    com.google.apis#google-api-services-storage;v1-rev20220705-2.0.0 from central in [default]
    com.google.auth#google-auth-library-credentials;1.16.0 from central in [default]
    com.google.auth#google-auth-library-oauth2-http;1.16.0 from central in [default]
    com.google.auto.value#auto-value;1.10.1 from central in [default]
    com.google.auto.value#auto-value-annotations;1.10.1 from central in [default]
    com.google.cloud#google-cloud-core;2.12.0 from central in [default]
    com.google.cloud#google-cloud-core-grpc;2.12.0 from central in [default]
    com.google.cloud#google-cloud-core-http;2.12.0 from central in [default]
    com.google.cloud#google-cloud-storage;2.20.1 from central in [default]
    com.google.code.findbugs#jsr305;3.0.2 from central in [default]
    com.google.code.gson#gson;2.10.1 from central in [default]
    com.google.errorprone#error_prone_annotations;2.18.0 from central in [default]
    com.google.guava#failureaccess;1.0.1 from central in [default]
    com.google.guava#guava;31.1-jre from central in [default]
    com.google.guava#listenablefuture;9999.0-empty-to-avoid-conflict-with-guava from central in [default]
    com.google.http-client#google-http-client;1.43.0 from central in [default]
    com.google.http-client#google-http-client-apache-v2;1.43.0 from central in [default]
    com.google.http-client#google-http-client-appengine;1.43.0 from central in [default]
    com.google.http-client#google-http-client-gson;1.43.0 from central in [default]
    com.google.http-client#google-http-client-jackson2;1.43.0 from central in [default]
    com.google.j2objc#j2objc-annotations;1.3 from central in [default]
    com.google.oauth-client#google-oauth-client;1.34.1 from central in [default]
    com.google.protobuf#protobuf-java;3.21.12 from central in [default]
    com.google.protobuf#protobuf-java-util;3.21.12 from central in [default]
    com.google.re2j#re2j;1.6 from central in [default]
    com.johnsnowlabs.nlp#jsl-llamacpp-cpu_2.12;0.1.4 from central in [default]
    com.johnsnowlabs.nlp#jsl-openvino-cpu_2.12;0.1.0 from central in [default]
    com.johnsnowlabs.nlp#spark-nlp_2.12;5.5.1 from central in [default]
    com.johnsnowlabs.nlp#tensorflow-cpu_2.12;0.4.4 from central in [default]
    com.microsoft.onnxruntime#onnxruntime;1.19.2 from central in [default]
    com.navigamez#greex;1.0 from central in [default]
    com.typesafe#config;1.4.2 from central in [default]
    commons-codec#commons-codec;1.15 from central in [default]
    commons-logging#commons-logging;1.1.3 from central in [default]
    dk.brics.automaton#automaton;1.11-8 from central in [default]
    io.grpc#grpc-alts;1.53.0 from central in [default]
    io.grpc#grpc-api;1.53.0 from central in [default]
    io.grpc#grpc-auth;1.53.0 from central in [default]
    io.grpc#grpc-context;1.53.0 from central in [default]
    io.grpc#grpc-core;1.53.0 from central in [default]
    io.grpc#grpc-googleapis;1.53.0 from central in [default]
    io.grpc#grpc-grpclb;1.53.0 from central in [default]
    io.grpc#grpc-netty-shaded;1.53.0 from central in [default]
    io.grpc#grpc-protobuf;1.53.0 from central in [default]
    io.grpc#grpc-protobuf-lite;1.53.0 from central in [default]
    io.grpc#grpc-services;1.53.0 from central in [default]
    io.grpc#grpc-stub;1.53.0 from central in [default]
    io.grpc#grpc-xds;1.53.0 from central in [default]
    io.opencensus#opencensus-api;0.31.1 from central in [default]
    io.opencensus#opencensus-contrib-http-util;0.31.1 from central in [default]
    io.opencensus#opencensus-proto;0.2.0 from central in [default]
    io.perfmark#perfmark-api;0.26.0 from central in [default]
    it.unimi.dsi#fastutil;7.0.12 from central in [default]
    javax.annotation#javax.annotation-api;1.3.2 from central in [default]
    joda-time#joda-time;2.8.1 from central in [default]
    org.apache.httpcomponents#httpclient;4.5.13 from central in [default]
    org.apache.httpcomponents#httpcore;4.4.13 from central in [default]
    org.checkerframework#checker-qual;3.31.0 from central in [default]
    org.codehaus.mojo#animal-sniffer-annotations;1.22 from central in [default]
    org.conscrypt#conscrypt-openjdk-uber;2.5.2 from central in [default]
    org.jetbrains#annotations;24.1.0 from central in [default]
    org.projectlombok#lombok;1.16.8 from central in [default]
    org.rocksdb#rocksdbjni;6.29.5 from central in [default]
    org.threeten#threetenbp;1.6.5 from central in [default]
    software.amazon.ion#ion-java;1.0.2 from central in [default]
    :: evicted modules:
    commons-logging#commons-logging;1.2 by [commons-logging#commons-logging;1.1.3] in [default]
    commons-codec#commons-codec;1.11 by [commons-codec#commons-codec;1.15] in [default]
    com.google.protobuf#protobuf-java-util;3.0.0-beta-3 by [com.google.protobuf#protobuf-java-util;3.21.12] in [default]
    com.google.protobuf#protobuf-java;3.0.0-beta-3 by [com.google.protobuf#protobuf-java;3.21.12] in [default]
    com.google.code.gson#gson;2.3 by [com.google.code.gson#gson;2.10.1] in [default]
    ---------------------------------------------------------------------
    |                  |            modules            ||   artifacts   |
    |       conf       | number| search|dwnlded|evicted|| number|dwnlded|
    ---------------------------------------------------------------------
    |      default     |   86  |   0   |   0   |   5   ||   81  |   0   |
    ---------------------------------------------------------------------
:: retrieving :: org.apache.spark#spark-submit-parent-74b5a337-1aa9-4b49-ac16-fc97eb9c486a
    confs: [default]
    0 artifacts copied, 81 already retrieved (0kB/29ms)
24/11/15 00:51:20 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Setting default log level to "WARN".
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>'3.4.0'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sparknlp</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sparknlp.base <span class="im">import</span> <span class="op">*</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sparknlp.annotator <span class="im">import</span> <span class="op">*</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sparknlp.pretrained <span class="im">import</span> PretrainedPipeline</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> functions <span class="im">as</span> f</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> col</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> Tokenizer, CountVectorizer, IDF</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml <span class="im">import</span> Pipeline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="74">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"sparknlp version: </span><span class="sc">{</span>sparknlp<span class="sc">.</span>version()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder <span class="op">\</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    .appName(<span class="st">"Spark NLP"</span>)<span class="op">\</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    .master(<span class="st">"local[*]"</span>)<span class="op">\</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">"spark.driver.memory"</span>,<span class="st">"16G"</span>)<span class="op">\</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">"spark.driver.maxResultSize"</span>, <span class="st">"0"</span>) <span class="op">\</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">"spark.kryoserializer.buffer.max"</span>, <span class="st">"2000M"</span>)<span class="op">\</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    .config(<span class="st">"spark.jars.packages"</span>, <span class="st">"com.johnsnowlabs.nlp:spark-nlp_2.12:5.1.3"</span>)<span class="op">\</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    .getOrCreate()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sparknlp version: 5.5.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>24/11/14 21:32:56 WARN SparkSession: Using an existing Spark session; only runtime SQL configurations will take effect.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> Tokenizer(inputCol<span class="op">=</span><span class="st">"text"</span>, outputCol<span class="op">=</span><span class="st">"words"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectorize the words using CountVectorizer (instead of HashingTF)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>countVectorizer <span class="op">=</span> CountVectorizer(inputCol<span class="op">=</span><span class="st">"words"</span>, outputCol<span class="op">=</span><span class="st">"raw_features"</span>, vocabSize<span class="op">=</span><span class="dv">1000</span>, minDF<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the IDF (Inverse Document Frequency)</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>idf <span class="op">=</span> IDF(inputCol<span class="op">=</span><span class="st">"raw_features"</span>, outputCol<span class="op">=</span><span class="st">"tfidf_features"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the pipeline</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>[tokenizer, countVectorizer, idf])</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and transform the data</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> pipeline.fit(df)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> model.transform(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>openjdk version "11.0.1-internal" 2018-10-16
OpenJDK Runtime Environment (build 11.0.1-internal+0-adhoc..src)
OpenJDK 64-Bit Server VM (build 11.0.1-internal+0-adhoc..src, mixed mode)</code></pre>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:true}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import pyspark and build Spark session</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">"""spark = (</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">    SparkSession.builder.appName("PySparkApp")</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">    .config("spark.jars.packages", "org.apache.hadoop:hadoop-aws:3.2.2")</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">    .config(</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co">        "fs.s3a.aws.credentials.provider",</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">        "com.amazonaws.auth.ContainerCredentialsProvider",</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">    )</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">    .getOrCreate()</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">)</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">print(spark.version) """</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ConnectionRefusedError: [Errno 111] Connection refused</code></pre>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:true}" data-scrolled="true" data-execution_count="3">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>time</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>comments <span class="op">=</span> spark.read.parquet(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"s3a://sagemaker-us-east-1-249863557958/project/comments"</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    header<span class="op">=</span><span class="va">True</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>comments.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>24/11/08 16:23:04 WARN MetricsConfig: Cannot locate configuration: tried hadoop-metrics2-s3a-file-system.properties,hadoop-metrics2.properties
[Stage 1:&gt;                                                          (0 + 1) / 1]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+----------------------+--------------------+--------------------+----------------+-----------+-------------+------+------+-------+----------+----------+------------+-----+--------+--------------+------------+
|              author|author_flair_css_class|   author_flair_text|                body|controversiality|created_utc|distinguished|edited|gilded|     id|   link_id| parent_id|retrieved_on|score|stickied|     subreddit|subreddit_id|
+--------------------+----------------------+--------------------+--------------------+----------------+-----------+-------------+------+------+-------+----------+----------+------------+-----+--------+--------------+------------+
|       TexasBoyz-713|                      |Platinum | QC: BT...|Dude I wouldn’t s...|               0| 1689744125|         null|  null|     0|jsjxjpu|t3_153et67|t1_jsjxgdf|  1689744144|    1|   false|CryptoCurrency|    t5_2wlj3|
|         bthemonarch|             Developer|   FOMO chub for all|Moons are the rea...|               0| 1689744128|         null|  null|     0|jsjxjuv|t3_153et67|t1_jsjxcqm|  1689744159|    1|   false|CryptoCurrency|    t5_2wlj3|
|        keithwee0909|                  null|                null|Should I buy some...|               0| 1689744130|         null|  null|     0|jsjxk0f|t3_153et67|t1_jsjxfk8|  1689744159|    1|   false|CryptoCurrency|    t5_2wlj3|
|           [deleted]|                  null|                null|           [removed]|               0| 1689744133|         null|  null|     0|jsjxk5v|t3_153et67|t3_153et67|  1689744159|    1|   false|CryptoCurrency|    t5_2wlj3|
|       Traveler-0854|                  null|                null|¢0.63\n\nWe are o...|               0| 1689744133|         null|  null|     0|jsjxk5x|t3_153et67|t3_153et67|  1689744159|    1|   false|CryptoCurrency|    t5_2wlj3|
|       Illicitterror|                  null|                null|    Prime Trustusbro|               0| 1689744133|         null|  null|     0|jsjxk66|t3_153axby|t3_153axby|  1689744159|    1|   false|CryptoCurrency|    t5_2wlj3|
|              vip887|      Warning-level2-2|                 Tin|Yup, a tiny mista...|               0| 1689744134|         null|  null|     0|jsjxk85|t3_153ky0e|t3_153ky0e|  1689744159|    1|   false|CryptoCurrency|    t5_2wlj3|
|         chintokkong|                      |Platinum | QC: CC 33|New Yorkers will ...|               0| 1689744137|         null|  null|     0|jsjxkfo|t3_153et67|t3_153et67|  1689744161|    1|   false|CryptoCurrency|    t5_2wlj3|
|       AutoModerator|                  null|                null|\nHere is a [Nitt...|               0| 1689744138|    moderator|  null|     0|jsjxkgp|t3_153et67|t1_jsjxkfo|  1689744161|    1|   false|CryptoCurrency|    t5_2wlj3|
|           ziggyzago|                      |Platinum | QC: CC...|I’m having crazy ...|               0| 1689744140|         null|  null|     0|jsjxkk4|t3_153et67|t3_153et67|  1689744161|    1|   false|CryptoCurrency|    t5_2wlj3|
|                R4ID|                      |Platinum | QC: CC...|with how fast it ...|               0| 1689744140|         null|  null|     0|jsjxkkr|t3_153lm7j|t3_153lm7j|  1689744161|    1|   false|CryptoCurrency|    t5_2wlj3|
|           RedBunery|                  null|                null|&gt; Cathie Wood ass...|               0| 1689744143|         null|  null|     0|jsjxks6|t3_153ip93|t3_153ip93|  1689744170|    1|   false|CryptoCurrency|    t5_2wlj3|
|            ccModBot|                   bot|              CC Bot|Hello!\n\nDirect ...|               0| 1689744148|    moderator|  null|     0|jsjxl1m|t3_153lm7j|t3_153lm7j|  1689744170|    1|    true|CryptoCurrency|    t5_2wlj3|
|CoolCoolPapaOldSkool|                      |Platinum | QC: CC...|Yellow for me for...|               0| 1689744148|         null|  null|     0|jsjxl24|t3_153lm7j|t3_153lm7j|  1689744170|    1|   false|CryptoCurrency|    t5_2wlj3|
|       Agile_Ad_7061|                  null|                null|No. Prince from N...|               0| 1689744150|         null|  null|     0|jsjxl4z|t3_153ky0e|t3_153ky0e|  1689744170|    1|   false|CryptoCurrency|    t5_2wlj3|
|           Frogmangy|      Warning-level2-2|     Tin | CC critic|Literally know a ...|               0| 1689744150|         null|  null|     0|jsjxl5i|t3_153ky0e|t1_jsjvuyx|  1689744170|    1|   false|CryptoCurrency|    t5_2wlj3|
|  ImNotFromThisWorld|      Warning-level2-2|                 Tin|Man I should have...|               0| 1689744163|         null|  null|     0|jsjxlx6|t3_153et67|t3_153et67|  1689744186|    1|   false|CryptoCurrency|    t5_2wlj3|
|          send_tacoz|                  null|                null|Aren't Doge price...|               0| 1689744172|         null|  null|     0|jsjxmgi|t3_153krw1|t3_153krw1|  1689744200|    1|   false|CryptoCurrency|    t5_2wlj3|
|      OddIndication4|      Warning-level2-2|                 Tin|Ask yourself the ...|               0| 1689744172|         null|  null|     0|jsjxmh7|t3_1539jks|t3_1539jks|  1689744200|    1|   false|CryptoCurrency|    t5_2wlj3|
|             chili21|      Warning-level2-2|                 Tin|           !gas nova|               0| 1689744176|         null|  null|     0|jsjxmpc|t3_12pf9pb|t3_12pf9pb|  1689744200|    1|   false|CryptoCurrency|    t5_2wlj3|
+--------------------+----------------------+--------------------+--------------------+----------------+-----------+-------------+------+------+-------+----------+----------+------------+-----+--------+--------------+------------+
only showing top 20 rows

CPU times: user 12.4 ms, sys: 151 μs, total: 12.5 ms
Wall time: 14.4 s</code></pre>
</div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>comments.groupBy(<span class="st">'subreddit'</span>).count().show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 2:======================================================&gt;(116 + 1) / 117]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------+-------+
|     subreddit|  count|
+--------------+-------+
|       finance|  25291|
|CryptoCurrency|3360896|
|     investing| 516497|
+--------------+-------+
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter to 1 1000th of the data for exploratory analysis</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>working_comments <span class="op">=</span> comments.sample(withReplacement <span class="op">=</span> <span class="va">False</span>, fraction <span class="op">=</span> <span class="fl">0.001</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="6">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>working_comments.write.parquet(<span class="st">"./small_sample_comments.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'working_comments' is not defined</code></pre>
</div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>working_comments2 <span class="op">=</span> spark.read.parquet(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"./small_sample_comments.parquet"</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    header<span class="op">=</span><span class="va">True</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>working_comments2.groupBy(<span class="st">'subreddit'</span>).count().show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 1:&gt;                                                          (0 + 4) / 4]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------+-----+
|     subreddit|count|
+--------------+-----+
|       finance|   32|
|CryptoCurrency| 3384|
|     investing|  465|
+--------------+-----+
</code></pre>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:true}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>working_comments2.select(f.col(<span class="st">'body'</span>)).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+
|                body|
+--------------------+
|We’ll all be rich...|
|It’s probably jus...|
|It's going to be ...|
|I will be laughin...|
|           [removed]|
|Always the countr...|
|I am excited to s...|
|           Over 9000|
|  That's incredible!|
|These are the Bit...|
|The real whale, r...|
|                 VTI|
|I mean that's one...|
|I love your enthu...|
|What a sack of sh...|
|Stablecoins aren'...|
|Sold 24% of my st...|
|Receiving them co...|
|Imagine u get pai...|
|What do we use mo...|
+--------------------+
only showing top 20 rows
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install sparknlp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Collecting sparknlp
  Downloading sparknlp-1.0.0-py3-none-any.whl.metadata (1.2 kB)
Collecting spark-nlp (from sparknlp)
  Downloading spark_nlp-5.5.1-py2.py3-none-any.whl.metadata (19 kB)
Requirement already satisfied: numpy in /opt/conda/lib/python3.11/site-packages (from sparknlp) (1.26.4)
Downloading sparknlp-1.0.0-py3-none-any.whl (1.4 kB)
Downloading spark_nlp-5.5.1-py2.py3-none-any.whl (626 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 626.6/626.6 kB 39.7 MB/s eta 0:00:00
Installing collected packages: spark-nlp, sparknlp
Successfully installed spark-nlp-5.5.1 sparknlp-1.0.0
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this sell is for non sparknlp EDA</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>working_comments2 <span class="op">=</span> working_comments2.withColumn(<span class="st">'bodylen'</span>, f.length(f.col(<span class="st">'body'</span>)))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>working_comments2.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+----------------------+--------------------+--------------------+----------------+-----------+-------------+------+------+-------+----------+----------+------------+-----+--------+--------------+------------+-------+
|              author|author_flair_css_class|   author_flair_text|                body|controversiality|created_utc|distinguished|edited|gilded|     id|   link_id| parent_id|retrieved_on|score|stickied|     subreddit|subreddit_id|bodylen|
+--------------------+----------------------+--------------------+--------------------+----------------+-----------+-------------+------+------+-------+----------+----------+------------+-----+--------+--------------+------------+-------+
|discussionandrespect|                      |sleeping peaceful...|We’ll all be rich...|               0| 1689744941|         null|  null|     0|jsjytab|t3_153et67|t1_jsjy5nd|  1689744965|    1|   false|CryptoCurrency|    t5_2wlj3|     44|
|          XWarriorYZ|                      |Platinum | QC: CC...|It’s probably jus...|               0| 1689747447|         null|  null|     0|jsk2hk9|t3_153lr3d|t3_153lr3d|  1689747473|    1|   false|CryptoCurrency|    t5_2wlj3|    109|
|             Jocogui|      Warning-level1-1|Bronze | 6 months...|It's going to be ...|               0| 1689749807|         null|  null|     0|jsk5r5b|t3_153mtyq|t1_jsk43y0|  1689749827|    1|   false|CryptoCurrency|    t5_2wlj3|    179|
|  JunglistMovement95|      Warning-level1-1|              Bronze|I will be laughin...|               0| 1689752349|         null|  null|     0|jsk93py|t3_152d296|t3_152d296|  1689752366|    1|   false|CryptoCurrency|    t5_2wlj3|     74|
|           [deleted]|                  null|                null|           [removed]|               0| 1689753235|         null|  null|     0|jska7z0|t3_153lt2n|t3_153lt2n|  1689753250|    1|   false|CryptoCurrency|    t5_2wlj3|      9|
|           DarioDays|      Warning-level2-2|                 Tin|Always the countr...|               0| 1689754347|         null|  null|     0|jskbm43|t3_153op2v|t3_153op2v|  1689754376|    1|   false|CryptoCurrency|    t5_2wlj3|    109|
|            lourkeur|      Warning-level2-2|                 Tin|I am excited to s...|               0| 1689755361|         null|  null|     0|jskcvjq|t3_1536efj|t1_jsiv8he|  1689755381|    1|   false|CryptoCurrency|    t5_2wlj3|    108|
|         Sorrytoruin|                  null|Platinum | QC: CC...|           Over 9000|               0| 1689756461|         null|  null|     0|jske8zn|t3_153nsfj|t1_jsk83k3|  1689756480|    1|   false|CryptoCurrency|    t5_2wlj3|      9|
|           XADEBRAVO|                  null|                null|  That's incredible!|               0| 1689756783|         null|  null|     0|jskenij|t3_153p4uf|t1_jskect5|  1689756808|    1|   false|CryptoCurrency|    t5_2wlj3|     18|
|             Zein313|                      |                    |These are the Bit...|               0| 1689758659|         null|  null|     0|jskgyz3|t3_152ftll|t3_152ftll|  1689758686|    1|   false|CryptoCurrency|    t5_2wlj3|    593|
|           KuronFury|      Warning-level2-2|                 Tin|The real whale, r...|               0| 1689758960|         null|  null|     0|jskhcp1|t3_153pgf8|t1_jskgt8t|  1689758983|    1|   false|CryptoCurrency|    t5_2wlj3|     26|
|         brianmcg321|                  null|                null|                 VTI|               0| 1689765813|         null|  null|     0|jskqyik|t3_153kqa9|t3_153kqa9|  1689765841|    1|   false|     investing|    t5_2qhhq|      3|
|            Ofulinac|                      |Platinum | QC: CC 32|I mean that's one...|               0| 1689767267|         null|  null|     0|jsktemq|t3_153sp41|t3_153sp41|  1689767284|    1|   false|CryptoCurrency|    t5_2wlj3|     99|
|            raphanum|      Warning-level2-2|                 Tin|I love your enthu...|               0| 1689767585|         null|  null|     0|jsktyxr|t3_153lr3d|t1_jskts2d|  1689767615|    1|   false|CryptoCurrency|    t5_2wlj3|    143|
|          VoxImperii|                      |Platinum | QC: CC...|What a sack of sh...|               0| 1689768416|         null|  null|     0|jskvhbo|t3_153rkm9|t3_153rkm9|  1689768439|    1|   false|CryptoCurrency|    t5_2wlj3|     63|
|        LargeSnorlax|                  null|                null|Stablecoins aren'...|               0| 1689771124|         null|  null|     0|jsl0r1p|t3_153sm6h|t1_jsktf7k|  1689771145|    1|   false|CryptoCurrency|    t5_2wlj3|    516|
|            omghag18|                      |                    |Sold 24% of my st...|               0| 1689771696|         null|  null|     0|jsl1yok|t3_153rkcw|t3_153rkcw|  1689771728|    1|   false|CryptoCurrency|    t5_2wlj3|    103|
|    Probably_notabot|      Warning-level2-2|     Tin | CC critic|Receiving them co...|               0| 1689771849|         null|  null|     0|jsl2a7p|t3_153lr3d|t1_jskx4nv|  1689771874|    1|   false|CryptoCurrency|    t5_2wlj3|     87|
|            Tasigur1|      Warning-level2-2|                 Tin|Imagine u get pai...|               0| 1689772482|         null|  null|     0|jsl3nxz|t3_153q4r1|t1_jsko2mz|  1689772509|    1|   false|CryptoCurrency|    t5_2wlj3|     67|
|         Carib_Coiin|      Warning-level2-2|                 Tin|What do we use mo...|               0| 1689772587|         null|  null|     0|jsl3w9u|t3_153tfdl|t1_jsl3t5g|  1689772613|    1|   false|CryptoCurrency|    t5_2wlj3|     31|
+--------------------+----------------------+--------------------+--------------------+----------------+-----------+-------------+------+------+-------+----------+----------+------------+-----+--------+--------------+------------+-------+
only showing top 20 rows
</code></pre>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:true}" data-scrolled="true" data-execution_count="7">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get a plot of the percentiles of the data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> Window</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>bodylens <span class="op">=</span> working_comments2.select(f.col(<span class="st">'bodylen'</span>))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>pct_list <span class="op">=</span> [<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.3</span>,<span class="fl">0.4</span>,<span class="fl">0.5</span>,<span class="fl">0.6</span>,<span class="fl">0.7</span>,<span class="fl">0.8</span>,<span class="fl">0.9</span>]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>percentiles <span class="op">=</span> bodylens.select( f.percentile_approx(f.col(<span class="st">'bodylen'</span>), percentage <span class="op">=</span> pct_list).alias(<span class="st">'percent'</span>)).toPandas()</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(percentiles)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#bodylens.withColumn("cd", f.cume_dist().over(w)).show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[Stage 5:=============================&gt;                             (2 + 2) / 4]                                                                                </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                                   percent
0  [12, 27, 39, 54, 70, 90, 122, 182, 322]</code></pre>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>percentile_list <span class="op">=</span> percentiles.loc[<span class="dv">0</span>,].item()</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>density_list <span class="op">=</span> []</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> index, item <span class="kw">in</span> <span class="bu">enumerate</span>(percentile_list):</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    lastval <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> index <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        lastval <span class="op">=</span> percentile_list[index<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    density <span class="op">=</span> <span class="fl">0.1</span> <span class="op">/</span> (item<span class="op">-</span>lastval)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>    density_list.append(density)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>plt.step(percentile_list, density_list)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Length of comment (chars)"</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Density"</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Distribution of Comment Lengths"</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'allcoment_length_density.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nlp_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>working_comments2.count()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>3881</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy variables for regex matches in the comments</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>snp <span class="op">=</span>   <span class="st">"(?i)s and p|(?i)s&amp;p|(?i)s&amp;p 500|(?i)s&amp;p500|(?i)s and p 500|(?i)spy|(?i)congress"</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>crypto <span class="op">=</span>    <span class="st">"(?i)bitcoin|(?i)btc|(?i)eth|(?i)ether|(?i)crypto|(?i)etherium|(?i)alts|(?i)altcoin|(?i)shitcoin"</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>fed <span class="op">=</span> <span class="st">"(?i)jp|(?i)powell|(?i)fed|(?i)federal reserve|(?i)jerome|(?i)jpow|(?i)printer"</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>working_comments2 <span class="op">=</span> working_comments2.withColumn(<span class="st">"snp"</span>, f.when(f.col(<span class="st">"body"</span>).rlike(snp), <span class="st">'true'</span>).otherwise(<span class="st">'false'</span>)) <span class="op">\</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>            .withColumn(<span class="st">"crypto"</span>, f.when(f.col(<span class="st">"body"</span>).rlike(crypto), <span class="st">'true'</span>).otherwise(<span class="st">'false'</span>)) <span class="op">\</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>            .withColumn(<span class="st">"fed"</span>, f.when(f.col(<span class="st">"body"</span>).rlike(fed), <span class="st">'true'</span>).otherwise(<span class="st">'false'</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>working_comments2.groupBy(<span class="st">'snp'</span>).count().show()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>working_comments2.groupBy(<span class="st">'crypto'</span>).count().show()</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>working_comments2.groupBy(<span class="st">'fed'</span>).count().show()</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># in 4k comments, 32 mention fed, 762 mention crypto, 31 mention the snp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-----+-----+
|  snp|count|
+-----+-----+
|false| 3850|
| true|   31|
+-----+-----+

+------+-----+
|crypto|count|
+------+-----+
| false| 3119|
|  true|  762|
+------+-----+

+-----+-----+
|  fed|count|
+-----+-----+
|false| 3849|
| true|   32|
+-----+-----+
</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get most common words in the comments?</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># use pipeline to tokenize strings</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make custom function to count occurences?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>working_comments2 <span class="op">=</span> working_comments2.withColumn(<span class="st">"body"</span>, f.lower(f.col(<span class="st">'body'</span>) ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> Tokenizer, CountVectorizer, IDF, StopWordsRemover, HashingTF</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml <span class="im">import</span> Pipeline</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> col</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> Tokenizer(inputCol<span class="op">=</span><span class="st">"body"</span>, outputCol<span class="op">=</span><span class="st">"words"</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Vectorize the words using CountVectorizer (instead of HashingTF)</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>stopwords_remover <span class="op">=</span> StopWordsRemover(inputCol<span class="op">=</span><span class="st">"words"</span>, outputCol<span class="op">=</span><span class="st">"filtered_words"</span>)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">#hashingTF = HashingTF(inputCol="filtered_words", outputCol="raw_features", numFeatures=20)</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="co">#countVectorizer = CountVectorizer(inputCol="filtered_words", outputCol="raw_features", vocabSize=1000, minDF=1)</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the IDF (Inverse Document Frequency)</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="co">#idf = IDF(inputCol="raw_features", outputCol="tfidf_features")</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the pipeline</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(stages<span class="op">=</span>[tokenizer, stopwords_remover])</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="52">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and transform the data</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> pipeline.fit(working_comments2)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> model.transform(working_comments2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true" data-execution_count="54">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>documentAssembler <span class="op">=</span> DocumentAssembler()<span class="op">\</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    .setInputCol(<span class="st">"body"</span>)<span class="op">\</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    .setOutputCol(<span class="st">"document"</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>MODEL_NAME<span class="op">=</span><span class="st">'sentimentdl_use_twitter'</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>use <span class="op">=</span> UniversalSentenceEncoder.pretrained(name<span class="op">=</span><span class="st">"tfhub_use"</span>, lang<span class="op">=</span><span class="st">"en"</span>)<span class="op">\</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a> .setInputCols([<span class="st">"document"</span>])<span class="op">\</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a> .setOutputCol(<span class="st">"sentence_embeddings"</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># convert text to lowercase, remove special characters, punctuation, and transform words based on a provided dictionary.</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>sentimentdl <span class="op">=</span> SentimentDLModel.pretrained(name<span class="op">=</span>MODEL_NAME, lang<span class="op">=</span><span class="st">"en"</span>)<span class="op">\</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    .setInputCols([<span class="st">"sentence_embeddings"</span>])<span class="op">\</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    .setOutputCol(<span class="st">"sentiments"</span>)</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>finisher<span class="op">=</span> (</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    Finisher()</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>    .setInputCols([<span class="st">"sentiments"</span>]).setOutputCols(<span class="st">"sentiment"</span>)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>nlpPipeline <span class="op">=</span> Pipeline(</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>      stages <span class="op">=</span> [</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>          documentAssembler,</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>          use,</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>          sentimentdl,</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>          finisher</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>      ])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tfhub_use download started this may take some time.
Approximate size to download 923.7 MB
[ | ][OK!]
sentimentdl_use_twitter download started this may take some time.
Approximate size to download 11.4 MB
[ | ][OK!]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>24/11/15 01:36:52 WARN S3AbortableInputStream: Not all bytes were read from the S3ObjectInputStream, aborting HTTP connection. This is likely an error and may result in sub-optimal behavior. Request only the bytes you need via a ranged GET or drain the input stream after use.
24/11/15 01:36:54 WARN S3AbortableInputStream: Not all bytes were read from the S3ObjectInputStream, aborting HTTP connection. This is likely an error and may result in sub-optimal behavior. Request only the bytes you need via a ranged GET or drain the input stream after use.</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>pipelineModel <span class="op">=</span> nlpPipeline.fit(working_comments2)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pipelineModel.transform(working_comments2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>results.printSchema()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>root
 |-- author: string (nullable = true)
 |-- author_flair_css_class: string (nullable = true)
 |-- author_flair_text: string (nullable = true)
 |-- body: string (nullable = true)
 |-- controversiality: long (nullable = true)
 |-- created_utc: long (nullable = true)
 |-- distinguished: string (nullable = true)
 |-- edited: double (nullable = true)
 |-- gilded: long (nullable = true)
 |-- id: string (nullable = true)
 |-- link_id: string (nullable = true)
 |-- parent_id: string (nullable = true)
 |-- retrieved_on: long (nullable = true)
 |-- score: long (nullable = true)
 |-- stickied: boolean (nullable = true)
 |-- subreddit: string (nullable = true)
 |-- subreddit_id: string (nullable = true)
 |-- bodylen: integer (nullable = true)
 |-- snp: string (nullable = false)
 |-- crypto: string (nullable = false)
 |-- fed: string (nullable = false)
 |-- sentiment: array (nullable = true)
 |    |-- element: string (containsNull = true)
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>sentimentdata <span class="op">=</span> results.select(f.col(<span class="st">'sentiment'</span>)).toPandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>24/11/14 20:50:55 WARN package: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting 'spark.sql.debug.maxToStringFields'.
                                                                                </code></pre>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:true}" data-scrolled="true" data-execution_count="78">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark <span class="im">import</span> SparkContext</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>sc <span class="op">=</span> SparkContext(<span class="st">"local"</span>, <span class="st">"Simple App"</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ValueError: Cannot run multiple SparkContexts at once; existing SparkContext(app=Spark NLP, master=local[*]) created by getOrCreate at /opt/conda/lib/python3.11/site-packages/sparknlp/__init__.py:199 </code></pre>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:true}" data-execution_count="81">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> udf</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.types <span class="im">import</span> FloatType</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="at">@udf</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_score(sentimentrow, i):</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(sentimentrow.item()[<span class="dv">0</span>].<span class="fu">__getitem__</span>(<span class="st">'metadata'</span>)[<span class="st">'positive'</span>]) <span class="op">-</span> <span class="bu">float</span>(sentimentrow.item()[<span class="dv">0</span>].<span class="fu">__getitem__</span>(<span class="st">'metadata'</span>)[<span class="st">'negative'</span>]) </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>scoreUDF <span class="op">=</span> udf(<span class="kw">lambda</span> x: get_score(x),FloatType() )</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>results.withColumn(<span class="st">'sentitems'</span>, f.col(<span class="st">'sentiment'</span>) ).show(<span class="dv">3</span>)</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a><span class="co">#results.withColumn('sent_score',   f.col('sentiment').item()[0].__getitem__('metadata')['positive'].cast('float') - f.col('sentiment').item()[0].__getitem__('metadata')['negative'].cast('float') ).show(5)</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co">#print(float(sentimentdata.loc[10].item()[0].__getitem__('metadata')['positive']) - float(sentimentdata.loc[10].item()[0].__getitem__('metadata')['negative']))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ParseException: 
[UNSUPPORTED_DATATYPE] Unsupported data type "LIST".(line 1, pos 0)

== SQL ==
list
^^^</code></pre>
</div>
</div>
<div class="cell" data-jupyter="{&quot;outputs_hidden&quot;:true}" data-execution_count="90">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>wget <span class="op">-</span>N https:<span class="op">//</span>s3.amazonaws.com<span class="op">/</span>auxdata.johnsnowlabs.com<span class="op">/</span>public<span class="op">/</span>resources<span class="op">/</span>en<span class="op">/</span>lemma<span class="op">-</span>corpus<span class="op">-</span>small<span class="op">/</span>lemmas_small.txt <span class="op">-</span>P .<span class="op">/</span>tmp <span class="op">--</span>no<span class="op">-</span>check<span class="op">-</span>certificate</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>wget <span class="op">-</span>N https:<span class="op">//</span>s3.amazonaws.com<span class="op">/</span>auxdata.johnsnowlabs.com<span class="op">/</span>public<span class="op">/</span>resources<span class="op">/</span>en<span class="op">/</span>sentiment<span class="op">-</span>corpus<span class="op">/</span>default<span class="op">-</span>sentiment<span class="op">-</span><span class="bu">dict</span>.txt <span class="op">-</span>P .<span class="op">/</span>tmp <span class="op">--</span>no<span class="op">-</span>check<span class="op">-</span>certificate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>--2024-11-14 21:42:19--  https://s3.amazonaws.com/auxdata.johnsnowlabs.com/public/resources/en/lemma-corpus-small/lemmas_small.txt
Resolving s3.amazonaws.com (s3.amazonaws.com)... 52.216.52.88, 54.231.135.24, 52.217.125.8, ...
Connecting to s3.amazonaws.com (s3.amazonaws.com)|52.216.52.88|:443... connected.
WARNING: cannot verify s3.amazonaws.com's certificate, issued by ‘CN=Amazon RSA 2048 M01,O=Amazon,C=US’:
  Unable to locally verify the issuer's authority.
HTTP request sent, awaiting response... 200 OK
Length: 189437 (185K) [text/plain]
Saving to: ‘./tmp/lemmas_small.txt’

lemmas_small.txt    100%[===================&gt;] 185.00K  --.-KB/s    in 0.007s  

2024-11-14 21:42:19 (25.5 MB/s) - ‘./tmp/lemmas_small.txt’ saved [189437/189437]

--2024-11-14 21:42:19--  https://s3.amazonaws.com/auxdata.johnsnowlabs.com/public/resources/en/sentiment-corpus/default-sentiment-dict.txt
Resolving s3.amazonaws.com (s3.amazonaws.com)... 52.217.200.40, 52.217.227.0, 52.217.142.152, ...
Connecting to s3.amazonaws.com (s3.amazonaws.com)|52.217.200.40|:443... connected.
WARNING: cannot verify s3.amazonaws.com's certificate, issued by ‘CN=Amazon RSA 2048 M01,O=Amazon,C=US’:
  Unable to locally verify the issuer's authority.
HTTP request sent, awaiting response... 200 OK
Length: 289 [text/plain]
Saving to: ‘./tmp/default-sentiment-dict.txt’

default-sentiment-d 100%[===================&gt;]     289  --.-KB/s    in 0s      

2024-11-14 21:42:19 (8.13 MB/s) - ‘./tmp/default-sentiment-dict.txt’ saved [289/289]
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the required modules and classes</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sparknlp.base <span class="im">import</span> DocumentAssembler, Pipeline, Finisher</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sparknlp.annotator <span class="im">import</span> (</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    SentenceDetector,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    Tokenizer,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    Lemmatizer,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    SentimentDetector</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co">#import sparknlp.annotator.pragmatic</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co">#from sparknlp.annotator.pragmatic import SentimentDetector</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyspark.sql.functions <span class="im">as</span> F</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Transforms raw texts to `document` annotation</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>document_assembler <span class="op">=</span> (</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    DocumentAssembler()</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    .setInputCol(<span class="st">"body"</span>)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>    .setOutputCol(<span class="st">"document"</span>)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Sentence Detection</span></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>sentence_detector <span class="op">=</span> SentenceDetector().setInputCols([<span class="st">"document"</span>]).setOutputCol(<span class="st">"sentence"</span>)</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Tokenization</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>tokenizer <span class="op">=</span> Tokenizer().setInputCols([<span class="st">"sentence"</span>]).setOutputCol(<span class="st">"token"</span>)</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Lemmatization</span></span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>lemmatizer<span class="op">=</span> Lemmatizer().setInputCols(<span class="st">"token"</span>).setOutputCol(<span class="st">"lemma"</span>) <span class="op">\</span></span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>                        .setDictionary(<span class="st">"./tmp/lemmas_small.txt"</span>, key_delimiter<span class="op">=</span><span class="st">"-&gt;"</span>, value_delimiter<span class="op">=</span><span class="st">"</span><span class="ch">\t</span><span class="st">"</span>)</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Sentiment Detection</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a>sentiment_detector<span class="op">=</span> (</span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>    SentimentDetector()</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>    .setInputCols([<span class="st">"lemma"</span>, <span class="st">"sentence"</span>]) <span class="op">\</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>    .setOutputCol(<span class="st">"sentiment_score"</span>) <span class="op">\</span></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>    .setDictionary(<span class="st">"./tmp/default-sentiment-dict.txt"</span>, <span class="st">","</span>)</span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>MODEL_NAME<span class="op">=</span><span class="st">'sentimentdl_use_twitter'</span></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>sentimentdl <span class="op">=</span> SentimentDLModel.pretrained(name<span class="op">=</span>MODEL_NAME, lang<span class="op">=</span><span class="st">"en"</span>)<span class="op">\</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>    .setInputCols([<span class="st">"lemma"</span>, <span class="st">"sentence"</span>])<span class="op">\</span></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>    .setOutputCol(<span class="st">"sentiment_score"</span>)</span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a><span class="co">#sentiment_detector.enableScore = True</span></span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 6: Finisher</span></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>finisher<span class="op">=</span> (</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>    Finisher()</span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>    .setInputCols([<span class="st">"sentiment_score"</span>]).setOutputCols(<span class="st">"sentiment"</span>)</span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the pipeline</span></span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>pipeline <span class="op">=</span> Pipeline(</span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a>    stages<span class="op">=</span>[</span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>        document_assembler,</span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>        sentence_detector, </span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>        tokenizer, </span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>        lemmatizer, </span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">#sentiment_detector, </span></span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a>        sentimentdl,</span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a>        finisher</span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sentimentdl_use_twitter download started this may take some time.
Approximate size to download 11.4 MB
[ | ]sentimentdl_use_twitter download started this may take some time.
Approximate size to download 11.4 MB
Download done! Loading the resource.
[ / ][OK!]</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>24/11/15 01:34:17 WARN S3AbortableInputStream: Not all bytes were read from the S3ObjectInputStream, aborting HTTP connection. This is likely an error and may result in sub-optimal behavior. Request only the bytes you need via a ranged GET or drain the input stream after use.
24/11/15 01:34:17 WARN S3AbortableInputStream: Not all bytes were read from the S3ObjectInputStream, aborting HTTP connection. This is likely an error and may result in sub-optimal behavior. Request only the bytes you need via a ranged GET or drain the input stream after use.
2024-11-15 01:34:20.792926: I external/org_tensorflow/tensorflow/core/platform/cpu_feature_guard.cc:151] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>TypeError: setInputCols in SentimentDLModel_eca587b575f7 expecting 1 columns. Provided column amount: 2. Which should be columns from the following annotators: ['sentence_embeddings']</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>pipelineModel <span class="op">=</span> pipeline.fit(working_comments2)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pipelineModel.transform(working_comments2)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.apache.spark.util.SizeEstimator$ (file:/opt/conda/lib/python3.11/site-packages/pyspark/jars/spark-core_2.12-3.4.0.jar) to field java.util.regex.Pattern.pattern
WARNING: Please consider reporting this to the maintainers of org.apache.spark.util.SizeEstimator$
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a future release</code></pre>
</div>
</div>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>results.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+--------------------+----------------------+--------------------+--------------------+----------------+-----------+-------------+------+------+-------+----------+----------+------------+-----+--------+--------------+------------+-------+-----+------+-----+----------+
|              author|author_flair_css_class|   author_flair_text|                body|controversiality|created_utc|distinguished|edited|gilded|     id|   link_id| parent_id|retrieved_on|score|stickied|     subreddit|subreddit_id|bodylen|  snp|crypto|  fed| sentiment|
+--------------------+----------------------+--------------------+--------------------+----------------+-----------+-------------+------+------+-------+----------+----------+------------+-----+--------+--------------+------------+-------+-----+------+-----+----------+
|discussionandrespect|                      |sleeping peaceful...|we’ll all be rich...|               0| 1689744941|         null|  null|     0|jsjytab|t3_153et67|t1_jsjy5nd|  1689744965|    1|   false|CryptoCurrency|    t5_2wlj3|     44|false| false|false|[positive]|
|          XWarriorYZ|                      |Platinum | QC: CC...|it’s probably jus...|               0| 1689747447|         null|  null|     0|jsk2hk9|t3_153lr3d|t3_153lr3d|  1689747473|    1|   false|CryptoCurrency|    t5_2wlj3|    109|false| false|false| [neutral]|
|             Jocogui|      Warning-level1-1|Bronze | 6 months...|it's going to be ...|               0| 1689749807|         null|  null|     0|jsk5r5b|t3_153mtyq|t1_jsk43y0|  1689749827|    1|   false|CryptoCurrency|    t5_2wlj3|    179|false|  true|false|[positive]|
|  JunglistMovement95|      Warning-level1-1|              Bronze|i will be laughin...|               0| 1689752349|         null|  null|     0|jsk93py|t3_152d296|t3_152d296|  1689752366|    1|   false|CryptoCurrency|    t5_2wlj3|     74|false| false|false|[positive]|
|           [deleted]|                  null|                null|           [removed]|               0| 1689753235|         null|  null|     0|jska7z0|t3_153lt2n|t3_153lt2n|  1689753250|    1|   false|CryptoCurrency|    t5_2wlj3|      9|false| false|false|[negative]|
|           DarioDays|      Warning-level2-2|                 Tin|always the countr...|               0| 1689754347|         null|  null|     0|jskbm43|t3_153op2v|t3_153op2v|  1689754376|    1|   false|CryptoCurrency|    t5_2wlj3|    109|false|  true|false|[positive]|
|            lourkeur|      Warning-level2-2|                 Tin|i am excited to s...|               0| 1689755361|         null|  null|     0|jskcvjq|t3_1536efj|t1_jsiv8he|  1689755381|    1|   false|CryptoCurrency|    t5_2wlj3|    108|false| false|false|[negative]|
|         Sorrytoruin|                  null|Platinum | QC: CC...|           over 9000|               0| 1689756461|         null|  null|     0|jske8zn|t3_153nsfj|t1_jsk83k3|  1689756480|    1|   false|CryptoCurrency|    t5_2wlj3|      9|false| false|false|[positive]|
|           XADEBRAVO|                  null|                null|  that's incredible!|               0| 1689756783|         null|  null|     0|jskenij|t3_153p4uf|t1_jskect5|  1689756808|    1|   false|CryptoCurrency|    t5_2wlj3|     18|false| false|false|[positive]|
|             Zein313|                      |                    |these are the bit...|               0| 1689758659|         null|  null|     0|jskgyz3|t3_152ftll|t3_152ftll|  1689758686|    1|   false|CryptoCurrency|    t5_2wlj3|    593|false|  true|false|[positive]|
|           KuronFury|      Warning-level2-2|                 Tin|the real whale, r...|               0| 1689758960|         null|  null|     0|jskhcp1|t3_153pgf8|t1_jskgt8t|  1689758983|    1|   false|CryptoCurrency|    t5_2wlj3|     26|false| false|false|[positive]|
|         brianmcg321|                  null|                null|                 vti|               0| 1689765813|         null|  null|     0|jskqyik|t3_153kqa9|t3_153kqa9|  1689765841|    1|   false|     investing|    t5_2qhhq|      3|false| false|false|[positive]|
|            Ofulinac|                      |Platinum | QC: CC 32|i mean that's one...|               0| 1689767267|         null|  null|     0|jsktemq|t3_153sp41|t3_153sp41|  1689767284|    1|   false|CryptoCurrency|    t5_2wlj3|     99|false| false|false|[positive]|
|            raphanum|      Warning-level2-2|                 Tin|i love your enthu...|               0| 1689767585|         null|  null|     0|jsktyxr|t3_153lr3d|t1_jskts2d|  1689767615|    1|   false|CryptoCurrency|    t5_2wlj3|    143|false|  true|false|[positive]|
|          VoxImperii|                      |Platinum | QC: CC...|what a sack of sh...|               0| 1689768416|         null|  null|     0|jskvhbo|t3_153rkm9|t3_153rkm9|  1689768439|    1|   false|CryptoCurrency|    t5_2wlj3|     63|false| false|false|[negative]|
|        LargeSnorlax|                  null|                null|stablecoins aren'...|               0| 1689771124|         null|  null|     0|jsl0r1p|t3_153sm6h|t1_jsktf7k|  1689771145|    1|   false|CryptoCurrency|    t5_2wlj3|    516|false|  true|false|[positive]|
|            omghag18|                      |                    |sold 24% of my st...|               0| 1689771696|         null|  null|     0|jsl1yok|t3_153rkcw|t3_153rkcw|  1689771728|    1|   false|CryptoCurrency|    t5_2wlj3|    103|false| false|false|[negative]|
|    Probably_notabot|      Warning-level2-2|     Tin | CC critic|receiving them co...|               0| 1689771849|         null|  null|     0|jsl2a7p|t3_153lr3d|t1_jskx4nv|  1689771874|    1|   false|CryptoCurrency|    t5_2wlj3|     87|false| false|false|[positive]|
|            Tasigur1|      Warning-level2-2|                 Tin|imagine u get pai...|               0| 1689772482|         null|  null|     0|jsl3nxz|t3_153q4r1|t1_jsko2mz|  1689772509|    1|   false|CryptoCurrency|    t5_2wlj3|     67|false| false|false| [neutral]|
|         Carib_Coiin|      Warning-level2-2|                 Tin|what do we use mo...|               0| 1689772587|         null|  null|     0|jsl3w9u|t3_153tfdl|t1_jsl3t5g|  1689772613|    1|   false|CryptoCurrency|    t5_2wlj3|     31|false| false|false|[positive]|
+--------------------+----------------------+--------------------+--------------------+----------------+-----------+-------------+------+------+-------+----------+----------+------------+-----+--------+--------------+------------+-------+-----+------+-----+----------+
only showing top 20 rows
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>sentiment_chart_columns <span class="op">=</span> (<span class="st">"sentiment"</span>,<span class="st">"subreddit"</span>, <span class="st">"snp"</span>,<span class="st">"crypto"</span>, <span class="st">"fed"</span> ,<span class="st">"score"</span>,<span class="st">"created_utc"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>clean_results <span class="op">=</span> results.select(<span class="op">*</span>sentiment_chart_columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>clean_results <span class="op">=</span> clean_results.withColumn(<span class="st">"created_utc"</span>, f.from_unixtime(<span class="st">"created_utc"</span>)) <span class="op">\</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>                .withColumn(<span class="st">'month'</span>, f.month(<span class="st">'created_utc'</span>)) <span class="op">\</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                .withColumn(<span class="st">'year'</span>, f.year(<span class="st">'created_utc'</span>)) <span class="op">\</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                .withColumn(<span class="st">'pos'</span>, f.when(f.col(<span class="st">'sentiment'</span>)[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'positive'</span>, <span class="dv">1</span>).otherwise(<span class="dv">0</span>)) <span class="op">\</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>                .withColumn(<span class="st">'neg'</span>, f.when(f.col(<span class="st">'sentiment'</span>)[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'negative'</span>, <span class="dv">1</span>).otherwise(<span class="dv">0</span>)) <span class="op">\</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>                .withColumn(<span class="st">'neu'</span>, f.when(f.col(<span class="st">'sentiment'</span>)[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'neutral'</span>, <span class="dv">1</span>).otherwise(<span class="dv">0</span>)) </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>                    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>clean_results.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------+--------------+-----+------+-----+-----+-------------------+-----+----+---+---+---+
| sentiment|     subreddit|  snp|crypto|  fed|score|        created_utc|month|year|pos|neg|neu|
+----------+--------------+-----+------+-----+-----+-------------------+-----+----+---+---+---+
|[positive]|CryptoCurrency|false| false|false|    1|2023-07-19 05:35:41|    7|2023|  1|  0|  0|
| [neutral]|CryptoCurrency|false| false|false|    1|2023-07-19 06:17:27|    7|2023|  0|  0|  1|
|[positive]|CryptoCurrency|false|  true|false|    1|2023-07-19 06:56:47|    7|2023|  1|  0|  0|
|[positive]|CryptoCurrency|false| false|false|    1|2023-07-19 07:39:09|    7|2023|  1|  0|  0|
|[negative]|CryptoCurrency|false| false|false|    1|2023-07-19 07:53:55|    7|2023|  0|  1|  0|
|[positive]|CryptoCurrency|false|  true|false|    1|2023-07-19 08:12:27|    7|2023|  1|  0|  0|
|[negative]|CryptoCurrency|false| false|false|    1|2023-07-19 08:29:21|    7|2023|  0|  1|  0|
|[positive]|CryptoCurrency|false| false|false|    1|2023-07-19 08:47:41|    7|2023|  1|  0|  0|
|[positive]|CryptoCurrency|false| false|false|    1|2023-07-19 08:53:03|    7|2023|  1|  0|  0|
|[positive]|CryptoCurrency|false|  true|false|    1|2023-07-19 09:24:19|    7|2023|  1|  0|  0|
|[positive]|CryptoCurrency|false| false|false|    1|2023-07-19 09:29:20|    7|2023|  1|  0|  0|
|[positive]|     investing|false| false|false|    1|2023-07-19 11:23:33|    7|2023|  1|  0|  0|
|[positive]|CryptoCurrency|false| false|false|    1|2023-07-19 11:47:47|    7|2023|  1|  0|  0|
|[positive]|CryptoCurrency|false|  true|false|    1|2023-07-19 11:53:05|    7|2023|  1|  0|  0|
|[negative]|CryptoCurrency|false| false|false|    1|2023-07-19 12:06:56|    7|2023|  0|  1|  0|
|[positive]|CryptoCurrency|false|  true|false|    1|2023-07-19 12:52:04|    7|2023|  1|  0|  0|
|[negative]|CryptoCurrency|false| false|false|    1|2023-07-19 13:01:36|    7|2023|  0|  1|  0|
|[positive]|CryptoCurrency|false| false|false|    1|2023-07-19 13:04:09|    7|2023|  1|  0|  0|
| [neutral]|CryptoCurrency|false| false|false|    1|2023-07-19 13:14:42|    7|2023|  0|  0|  1|
|[positive]|CryptoCurrency|false| false|false|    1|2023-07-19 13:16:27|    7|2023|  1|  0|  0|
+----------+--------------+-----+------+-----+-----+-------------------+-----+----+---+---+---+
only showing top 20 rows
</code></pre>
</div>
</div>
<div class="cell" data-execution_count="135">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>sentiment_over_time <span class="op">=</span> clean_results.groupBy(<span class="st">'year'</span>,<span class="st">'month'</span>).agg(f.count(<span class="st">'*'</span>).alias(<span class="st">'total'</span>),</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                                          f.<span class="bu">sum</span>(<span class="st">'pos'</span>).alias(<span class="st">'postotal'</span>),</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                                         f.<span class="bu">sum</span>(<span class="st">'neg'</span>).alias(<span class="st">'negtotal'</span>),</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                                         f.<span class="bu">sum</span>(<span class="st">'neu'</span>).alias(<span class="st">'neutotal'</span>)).toPandas()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>sentiment_over_time.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">total</th>
<th data-quarto-table-cell-role="th">postotal</th>
<th data-quarto-table-cell-role="th">negtotal</th>
<th data-quarto-table-cell-role="th">neutotal</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2024</td>
<td>7</td>
<td>105</td>
<td>55</td>
<td>43</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2023</td>
<td>8</td>
<td>665</td>
<td>400</td>
<td>241</td>
<td>24</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2023</td>
<td>9</td>
<td>608</td>
<td>338</td>
<td>234</td>
<td>36</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2024</td>
<td>3</td>
<td>244</td>
<td>140</td>
<td>92</td>
<td>12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2023</td>
<td>7</td>
<td>522</td>
<td>301</td>
<td>194</td>
<td>27</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="138">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>sentiment_over_time[<span class="st">'DATE'</span>] <span class="op">=</span> pd.to_datetime(sentiment_over_time[[<span class="st">'year'</span>, <span class="st">'month'</span>]].assign(DAY<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,sentiment_over_time.shape[<span class="dv">0</span>]):</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> sentiment_over_time.loc[row,<span class="st">'total'</span>]</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    sentiment_over_time.loc[row,<span class="st">'posshare'</span>] <span class="op">=</span> sentiment_over_time.loc[row,<span class="st">'postotal'</span>] <span class="op">/</span> total</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>    sentiment_over_time.loc[row,<span class="st">'negshare'</span>] <span class="op">=</span> sentiment_over_time.loc[row,<span class="st">'negtotal'</span>] <span class="op">/</span> total</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    sentiment_over_time.loc[row,<span class="st">'neushare'</span>] <span class="op">=</span> sentiment_over_time.loc[row,<span class="st">'neutotal'</span>] <span class="op">/</span> total</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>sentiment_over_time.sort_values(<span class="st">'DATE'</span>, inplace <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.plot(sentiment_over_time['DATE'], sentiment_over_time['total'], color = 'gray', label = 'all comments')</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>plt.plot(sentiment_over_time[<span class="st">'DATE'</span>], sentiment_over_time[<span class="st">'posshare'</span>], color <span class="op">=</span> <span class="st">'b'</span>, label <span class="op">=</span> <span class="st">'positive comments'</span>)</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>plt.plot(sentiment_over_time[<span class="st">'DATE'</span>], sentiment_over_time[<span class="st">'negshare'</span>], color <span class="op">=</span> <span class="st">'r'</span>, label <span class="op">=</span> <span class="st">'negative comments'</span>)</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>plt.plot(sentiment_over_time[<span class="st">'DATE'</span>], sentiment_over_time[<span class="st">'neushare'</span>], color <span class="op">=</span> <span class="st">'purple'</span>, label <span class="op">=</span> <span class="st">'neutral comments'</span>)</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-21"><a href="#cb78-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Share of Comments by Sentiment'</span>)</span>
<span id="cb78-22"><a href="#cb78-22" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb78-23"><a href="#cb78-23" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Share of Comments'</span>)</span>
<span id="cb78-24"><a href="#cb78-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-25"><a href="#cb78-25" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb78-26"><a href="#cb78-26" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb78-27"><a href="#cb78-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-28"><a href="#cb78-28" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'sentiment_share_of_comments.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="nlp_files/figure-html/cell-42-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="102">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># group by number of comments with each sentiment for each mention</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>sentiment_mentions <span class="op">=</span> clean_results.groupBy(<span class="st">'snp'</span>,<span class="st">'crypto'</span>,<span class="st">'fed'</span>).agg(f.count(<span class="st">'*'</span>).alias(<span class="st">'total'</span>),</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>                                          f.<span class="bu">sum</span>(<span class="st">'pos'</span>).alias(<span class="st">'postotal'</span>),</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>                                         f.<span class="bu">sum</span>(<span class="st">'neg'</span>).alias(<span class="st">'negtotal'</span>),</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>                                         f.<span class="bu">sum</span>(<span class="st">'neu'</span>).alias(<span class="st">'neutotal'</span>)).toPandas()</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>                                                                                </code></pre>
</div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a table </span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dataframe_image <span class="im">as</span> dfi</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust numbers to be percent of total</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>,sentiment_mentions.shape[<span class="dv">0</span>]):</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> sentiment_mentions.loc[row,<span class="st">'total'</span>]</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    sentiment_mentions.loc[row,<span class="st">'postotal'</span>] <span class="op">=</span> sentiment_mentions.loc[row,<span class="st">'postotal'</span>] <span class="op">/</span> total</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>    sentiment_mentions.loc[row,<span class="st">'negtotal'</span>] <span class="op">=</span> sentiment_mentions.loc[row,<span class="st">'negtotal'</span>] <span class="op">/</span> total</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>    sentiment_mentions.loc[row,<span class="st">'neutotal'</span>] <span class="op">=</span> sentiment_mentions.loc[row,<span class="st">'neutotal'</span>] <span class="op">/</span> total</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>sentiment_mentions[<span class="st">'total'</span>] <span class="op">=</span> sentiment_mentions[<span class="st">'total'</span>] <span class="op">/</span> <span class="bu">sum</span>(sentiment_mentions[<span class="st">'total'</span>])</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a><span class="co">#sentiment_mentions = sentiment_mentions.round(2)</span></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co">#pd.options.display.float_format = "{:,.2f}".format</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a>sentiment_mentions.columns <span class="op">=</span> [<span class="st">'S&amp;P Mentioned'</span>, <span class="st">'Crypto Mentioned'</span>, <span class="st">'Fed Mentioned'</span>, <span class="st">'Share of All Comments'</span>, <span class="st">'% Positive'</span>, <span class="st">'% Negative'</span>, <span class="st">'% Neutral'</span>]</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>df_styled <span class="op">=</span> sentiment_mentions.style.background_gradient()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_135/3390288318.py:7: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '0.6917900403768507' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  sentiment_mentions.loc[row,'postotal'] = sentiment_mentions.loc[row,'postotal'] / total
/tmp/ipykernel_135/3390288318.py:8: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '0.27456258411843876' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  sentiment_mentions.loc[row,'negtotal'] = sentiment_mentions.loc[row,'negtotal'] / total
/tmp/ipykernel_135/3390288318.py:9: FutureWarning: Setting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value '0.033647375504710635' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.
  sentiment_mentions.loc[row,'neutotal'] = sentiment_mentions.loc[row,'neutotal'] / total</code></pre>
</div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df_styled</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<style type="text/css">
#T_3e501_row0_col3, #T_3e501_row0_col5, #T_3e501_row0_col6, #T_3e501_row3_col3, #T_3e501_row3_col6, #T_3e501_row4_col6, #T_3e501_row5_col3, #T_3e501_row5_col5, #T_3e501_row5_col6, #T_3e501_row6_col3, #T_3e501_row6_col6, #T_3e501_row7_col4 {
  background-color: #fff7fb;
  color: #000000;
}
#T_3e501_row0_col4, #T_3e501_row2_col3, #T_3e501_row5_col4, #T_3e501_row6_col5, #T_3e501_row7_col6 {
  background-color: #023858;
  color: #f1f1f1;
}
#T_3e501_row1_col3 {
  background-color: #d2d3e7;
  color: #000000;
}
#T_3e501_row1_col4 {
  background-color: #81aed2;
  color: #f1f1f1;
}
#T_3e501_row1_col5 {
  background-color: #4094c3;
  color: #f1f1f1;
}
#T_3e501_row1_col6 {
  background-color: #d9d8ea;
  color: #000000;
}
#T_3e501_row2_col4 {
  background-color: #dad9ea;
  color: #000000;
}
#T_3e501_row2_col5 {
  background-color: #045483;
  color: #f1f1f1;
}
#T_3e501_row2_col6 {
  background-color: #b1c2de;
  color: #000000;
}
#T_3e501_row3_col4 {
  background-color: #71a8ce;
  color: #f1f1f1;
}
#T_3e501_row3_col5 {
  background-color: #358fc0;
  color: #f1f1f1;
}
#T_3e501_row4_col3, #T_3e501_row7_col3 {
  background-color: #fef6fb;
  color: #000000;
}
#T_3e501_row4_col4 {
  background-color: #1e80b8;
  color: #f1f1f1;
}
#T_3e501_row4_col5 {
  background-color: #9cb9d9;
  color: #000000;
}
#T_3e501_row6_col4 {
  background-color: #d8d7e9;
  color: #000000;
}
#T_3e501_row7_col5 {
  background-color: #034b76;
  color: #f1f1f1;
}
</style>

<table id="T_3e501" data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_3e501_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">S&amp;P Mentioned</th>
<th id="T_3e501_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">Crypto Mentioned</th>
<th id="T_3e501_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">Fed Mentioned</th>
<th id="T_3e501_level0_col3" class="col_heading level0 col3" data-quarto-table-cell-role="th">Share of All Comments</th>
<th id="T_3e501_level0_col4" class="col_heading level0 col4" data-quarto-table-cell-role="th">% Positive</th>
<th id="T_3e501_level0_col5" class="col_heading level0 col5" data-quarto-table-cell-role="th">% Negative</th>
<th id="T_3e501_level0_col6" class="col_heading level0 col6" data-quarto-table-cell-role="th">% Neutral</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_3e501_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">0</td>
<td id="T_3e501_row0_col0" class="data row0 col0">true</td>
<td id="T_3e501_row0_col1" class="data row0 col1">true</td>
<td id="T_3e501_row0_col2" class="data row0 col2">true</td>
<td id="T_3e501_row0_col3" class="data row0 col3">0.000258</td>
<td id="T_3e501_row0_col4" class="data row0 col4">1.000000</td>
<td id="T_3e501_row0_col5" class="data row0 col5">0.000000</td>
<td id="T_3e501_row0_col6" class="data row0 col6">0.000000</td>
</tr>
<tr class="even">
<td id="T_3e501_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">1</td>
<td id="T_3e501_row1_col0" class="data row1 col0">false</td>
<td id="T_3e501_row1_col1" class="data row1 col1">true</td>
<td id="T_3e501_row1_col2" class="data row1 col2">false</td>
<td id="T_3e501_row1_col3" class="data row1 col3">0.191446</td>
<td id="T_3e501_row1_col4" class="data row1 col4">0.691790</td>
<td id="T_3e501_row1_col5" class="data row1 col5">0.274563</td>
<td id="T_3e501_row1_col6" class="data row1 col6">0.033647</td>
</tr>
<tr class="odd">
<td id="T_3e501_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">2</td>
<td id="T_3e501_row2_col0" class="data row2 col0">false</td>
<td id="T_3e501_row2_col1" class="data row2 col1">false</td>
<td id="T_3e501_row2_col2" class="data row2 col2">false</td>
<td id="T_3e501_row2_col3" class="data row2 col3">0.792837</td>
<td id="T_3e501_row2_col4" class="data row2 col4">0.538837</td>
<td id="T_3e501_row2_col5" class="data row2 col5">0.407215</td>
<td id="T_3e501_row2_col6" class="data row2 col6">0.053949</td>
</tr>
<tr class="even">
<td id="T_3e501_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">3</td>
<td id="T_3e501_row3_col0" class="data row3 col0">true</td>
<td id="T_3e501_row3_col1" class="data row3 col1">true</td>
<td id="T_3e501_row3_col2" class="data row3 col2">false</td>
<td id="T_3e501_row3_col3" class="data row3 col3">0.001804</td>
<td id="T_3e501_row3_col4" class="data row3 col4">0.714286</td>
<td id="T_3e501_row3_col5" class="data row3 col5">0.285714</td>
<td id="T_3e501_row3_col6" class="data row3 col6">0.000000</td>
</tr>
<tr class="odd">
<td id="T_3e501_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">4</td>
<td id="T_3e501_row4_col0" class="data row4 col0">true</td>
<td id="T_3e501_row4_col1" class="data row4 col1">false</td>
<td id="T_3e501_row4_col2" class="data row4 col2">false</td>
<td id="T_3e501_row4_col3" class="data row4 col3">0.005669</td>
<td id="T_3e501_row4_col4" class="data row4 col4">0.818182</td>
<td id="T_3e501_row4_col5" class="data row4 col5">0.181818</td>
<td id="T_3e501_row4_col6" class="data row4 col6">0.000000</td>
</tr>
<tr class="even">
<td id="T_3e501_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">5</td>
<td id="T_3e501_row5_col0" class="data row5 col0">true</td>
<td id="T_3e501_row5_col1" class="data row5 col1">false</td>
<td id="T_3e501_row5_col2" class="data row5 col2">true</td>
<td id="T_3e501_row5_col3" class="data row5 col3">0.000258</td>
<td id="T_3e501_row5_col4" class="data row5 col4">1.000000</td>
<td id="T_3e501_row5_col5" class="data row5 col5">0.000000</td>
<td id="T_3e501_row5_col6" class="data row5 col6">0.000000</td>
</tr>
<tr class="odd">
<td id="T_3e501_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">6</td>
<td id="T_3e501_row6_col0" class="data row6 col0">false</td>
<td id="T_3e501_row6_col1" class="data row6 col1">true</td>
<td id="T_3e501_row6_col2" class="data row6 col2">true</td>
<td id="T_3e501_row6_col3" class="data row6 col3">0.002834</td>
<td id="T_3e501_row6_col4" class="data row6 col4">0.545455</td>
<td id="T_3e501_row6_col5" class="data row6 col5">0.454545</td>
<td id="T_3e501_row6_col6" class="data row6 col6">0.000000</td>
</tr>
<tr class="even">
<td id="T_3e501_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">7</td>
<td id="T_3e501_row7_col0" class="data row7 col0">false</td>
<td id="T_3e501_row7_col1" class="data row7 col1">false</td>
<td id="T_3e501_row7_col2" class="data row7 col2">true</td>
<td id="T_3e501_row7_col3" class="data row7 col3">0.004896</td>
<td id="T_3e501_row7_col4" class="data row7 col4">0.421053</td>
<td id="T_3e501_row7_col5" class="data row7 col5">0.421053</td>
<td id="T_3e501_row7_col6" class="data row7 col6">0.157895</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plots</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot 1: average sentiment across a</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>ll comments over time(lines)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot 2: share of pos/neg/neurtral sentiment (stacked bars)</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot 3: daily mentions of fed vs. daily sentiment? (scatter)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Content 2023 by [Project Team 1] <br> All content licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">Made with and <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/anly503/lab-2.1">View the source at GitHub</a></div>
  </div>
</footer>



</body></html>